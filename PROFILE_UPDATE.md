# Обновление профиля в админ-панели

## Что изменено

✅ **Header теперь показывает реальные данные залогиненного администратора**

### Изменения в `AdminLayout.tsx`:

1. **Добавлена загрузка профиля администратора**

   - При монтировании компонента загружаются данные текущего пользователя
   - Если токен невалиден, происходит автоматическое перенаправление на страницу входа

2. **Обновлен header**

   - **Аватар**: Показываются инициалы (первые буквы имени и фамилии)
   - **Имя**: Полное имя администратора (Имя Фамилия)
   - **Роль**: Русскоязычное название роли:
     - SUPER_ADMIN → "Суперадминистратор"
     - ADMIN → "Администратор"
     - MANAGER → "Менеджер"
     - OPERATOR → "Оператор"

3. **Добавлена функция выхода**

   - Кнопка "Выйти" в сайдбаре теперь функциональна
   - При клике удаляется токен и происходит перенаправление на страницу входа
   - Добавлен hover эффект (красный цвет)

4. **Автоматическая защита**
   - Если пользователь не авторизован, автоматически перенаправляется на `/admin/login`
   - При ошибке загрузки профиля (невалидный токен), также происходит перенаправление

## Функции

### `loadProfile()`

```typescript
// Загружает профиль администратора при монтировании компонента
// Проверяет наличие токена
// При ошибке перенаправляет на страницу входа
```

### `handleLogout()`

```typescript
// Выход из системы
// Удаляет токен из localStorage
// Перенаправляет на страницу входа
```

### `getInitials()`

```typescript
// Возвращает инициалы администратора
// Например: "Farrukh Oripov" → "FO"
```

### `getRoleLabel()`

```typescript
// Возвращает русскоязычное название роли
// Например: "SUPER_ADMIN" → "Суперадминистратор"
```

## Как это работает

### 1. Вход в систему

```
Пользователь входит → Токен сохраняется → Перенаправление на dashboard
```

### 2. Загрузка профиля

```
Компонент монтируется → useEffect вызывается →
AuthService.getProfile() → Данные сохраняются в состояние →
Header обновляется с реальными данными
```

### 3. Отображение данных

```typescript
// В header показывается:
{
  avatar: getInitials(), // "FO"
  name: `${admin.firstName} ${admin.lastName}`, // "Farrukh Oripov"
  role: getRoleLabel() // "Суперадминистратор"
}
```

### 4. Выход из системы

```
Клик на "Выйти" → handleLogout() →
Токен удаляется → Перенаправление на /admin/login
```

## Состояния загрузки

Во время загрузки профиля показываются:

- **Аватар**: "..."
- **Имя**: "Загрузка..."
- **Роль**: пусто

После загрузки показываются реальные данные.

## Защита маршрутов

Если токен отсутствует или невалиден:

```typescript
useEffect(() => {
  if (!AuthService.isAuthenticated()) {
    navigate("/admin/login");
    return;
  }
  // ... загрузка профиля
});
```

## API эндпоинты

### GET /api/auth/profile

```typescript
// Заголовки:
Authorization: Bearer <JWT_TOKEN>

// Ответ:
{
  success: true,
  data: {
    id: 1,
    email: "farrukh.oripov@gmail.com",
    firstName: "Farrukh",
    lastName: "Oripov",
    role: "SUPER_ADMIN",
    isActive: true,
    lastLogin: "2024-10-12T...",
    createdAt: "2024-10-12T..."
  }
}
```

## Пример использования

### Для суперадминистратора:

1. Email: `farrukh.oripov@gmail.com`
2. Пароль: `eNL+i6wQ$56Kj?W`
3. После входа в header будет показано:
   - Аватар: **FO**
   - Имя: **Farrukh Oripov**
   - Роль: **Суперадминистратор**

## Стили

### Кнопка выхода

```css
/* Обычное состояние */
text-gray-700

/* Hover состояние */
hover:bg-red-50
hover:text-red-600
```

### Аватар

```css
h-8 w-8 rounded-full bg-blue-600
text-white font-medium
```

## Проверка

Откройте админ-панель и убедитесь:

- ✅ В header показывается ваше имя вместо "Диспетчер"
- ✅ Показывается ваша роль вместо "STC Transfer"
- ✅ Аватар содержит ваши инициалы
- ✅ Кнопка "Выйти" работает и перенаправляет на страницу входа
- ✅ После повторного входа данные снова загружаются

---

**Дата обновления:** 12 октября 2024
