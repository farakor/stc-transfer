<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç —Ü–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ booking</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .btn {
      background: #3b82f6;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 10px;
      font-size: 16px;
    }

    .btn:hover {
      background: #2563eb;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 12px;
    }

    .success {
      background: #d1fae5;
      border: 1px solid #10b981;
      color: #065f46;
    }

    .error {
      background: #fee2e2;
      border: 1px solid #ef4444;
      color: #991b1b;
    }

    .loading {
      background: #fef3c7;
      border: 1px solid #f59e0b;
      color: #92400e;
    }

    .price-card {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
    }

    .price-title {
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 8px;
    }

    .price-details {
      font-size: 14px;
      color: #64748b;
    }

    .price-total {
      font-size: 18px;
      font-weight: bold;
      color: #059669;
      margin-top: 8px;
    }

    .route-type {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .route-type.database {
      background: #d1fae5;
      color: #065f46;
    }

    .route-type.fixed {
      background: #fef3c7;
      color: #92400e;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üß™ –¢–µ—Å—Ç —Ü–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ booking</h1>
    <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ booking —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—ã –∏–∑ —Ç–∞—Ä–∏—Ñ–æ–≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.</p>

    <div>
      <button class="btn" onclick="testDatabaseTariffs()">üí∞ –¢–µ—Å—Ç —Ç–∞—Ä–∏—Ñ–æ–≤ –∏–∑ –ë–î</button>
      <button class="btn" onclick="testFixedPrices()">üè∑Ô∏è –¢–µ—Å—Ç —Ö–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ü–µ–Ω</button>
      <button class="btn" onclick="testAllScenarios()">üéØ –¢–µ—Å—Ç –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤</button>
    </div>

    <div id="result"></div>
  </div>

  <script>
    function showResult(message, type = 'success') {
      const resultDiv = document.getElementById('result');
      resultDiv.className = `result ${type}`;
      resultDiv.innerHTML = message;
    }

    function showLoading(message) {
      showResult(message, 'loading');
    }

    function formatPrice(amount) {
      return new Intl.NumberFormat('ru-RU').format(amount) + ' —Å—É–º';
    }

    function createPriceCard(data, title) {
      const routeTypeClass = data.routeType === 'DATABASE' ? 'database' : 'fixed';
      const routeTypeText = data.routeType === 'DATABASE' ? '–ò–∑ –ë–î' : '–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è';

      return `
                <div class="price-card">
                    <div class="price-title">
                        ${title}
                        <span class="route-type ${routeTypeClass}">${routeTypeText}</span>
                    </div>
                    <div class="price-details">
                        ${data.breakdown.map(item => `‚Ä¢ ${item.label}: ${formatPrice(item.amount)}`).join('<br>')}
                    </div>
                    <div class="price-total">
                        –ò—Ç–æ–≥–æ: ${formatPrice(data.totalPrice)}
                    </div>
                </div>
            `;
    }

    async function calculatePrice(fromCity, toCity, vehicleType) {
      const response = await fetch('http://localhost:3001/api/routes/calculate-price', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          fromCity,
          toCity,
          vehicleType
        })
      });

      if (!response.ok) {
        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
      }

      const result = await response.json();
      if (!result.success) {
        throw new Error(result.error || '–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã');
      }

      return result.data;
    }

    async function testDatabaseTariffs() {
      showLoading('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç–∞—Ä–∏—Ñ—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');

      try {
        const tests = [
          {
            title: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ ‚Üí –ê—ç—Ä–æ–ø–æ—Ä—Ç (SEDAN)',
            from: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ (—Ü–µ–Ω—Ç—Ä)',
            to: '–ê—ç—Ä–æ–ø–æ—Ä—Ç –°–∞–º–∞—Ä–∫–∞–Ω–¥–∞',
            vehicle: 'SEDAN'
          },
          {
            title: '–ê—ç—Ä–æ–ø–æ—Ä—Ç ‚Üí –°–∞–º–∞—Ä–∫–∞–Ω–¥ (BUS)',
            from: '–ê—ç—Ä–æ–ø–æ—Ä—Ç –°–∞–º–∞—Ä–∫–∞–Ω–¥–∞',
            to: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ (—Ü–µ–Ω—Ç—Ä)',
            vehicle: 'BUS'
          }
        ];

        let results = '‚úÖ –¢–∞—Ä–∏—Ñ—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—é—Ç!\n\n';

        for (const test of tests) {
          const data = await calculatePrice(test.from, test.to, test.vehicle);
          results += createPriceCard(data, test.title);
        }

        showResult(results, 'success');
      } catch (error) {
        showResult(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ –∏–∑ –ë–î:\n\n${error.message}`, 'error');
      }
    }

    async function testFixedPrices() {
      showLoading('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ö–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã...');

      try {
        const tests = [
          {
            title: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ ‚Üí –ê—ç—Ä–æ–ø–æ—Ä—Ç (SEDAN)',
            from: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ (—Ü–µ–Ω—Ç—Ä)',
            to: '–ê—ç—Ä–æ–ø–æ—Ä—Ç',
            vehicle: 'SEDAN'
          },
          {
            title: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ ‚Üí –ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π –≤–æ–∫–∑–∞–ª (PREMIUM)',
            from: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ (—Ü–µ–Ω—Ç—Ä)',
            to: '–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω—ã–π –≤–æ–∫–∑–∞–ª',
            vehicle: 'PREMIUM'
          }
        ];

        let results = '‚úÖ –•–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç!\n\n';

        for (const test of tests) {
          const data = await calculatePrice(test.from, test.to, test.vehicle);
          results += createPriceCard(data, test.title);
        }

        showResult(results, 'success');
      } catch (error) {
        showResult(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ö–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ü–µ–Ω:\n\n${error.message}`, 'error');
      }
    }

    async function testAllScenarios() {
      showLoading('üîÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏...');

      try {
        const tests = [
          // –¢–∞—Ä–∏—Ñ—ã –∏–∑ –ë–î
          {
            title: 'üóÑÔ∏è –ë–î: –°–∞–º–∞—Ä–∫–∞–Ω–¥ ‚Üí –ê—ç—Ä–æ–ø–æ—Ä—Ç (SEDAN)',
            from: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ (—Ü–µ–Ω—Ç—Ä)',
            to: '–ê—ç—Ä–æ–ø–æ—Ä—Ç –°–∞–º–∞—Ä–∫–∞–Ω–¥–∞',
            vehicle: 'SEDAN'
          },
          {
            title: 'üóÑÔ∏è –ë–î: –ê—ç—Ä–æ–ø–æ—Ä—Ç ‚Üí –°–∞–º–∞—Ä–∫–∞–Ω–¥ (BUS)',
            from: '–ê—ç—Ä–æ–ø–æ—Ä—Ç –°–∞–º–∞—Ä–∫–∞–Ω–¥–∞',
            to: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ (—Ü–µ–Ω—Ç—Ä)',
            vehicle: 'BUS'
          },
          // –•–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã
          {
            title: 'üè∑Ô∏è –§–∏–∫—Å: –°–∞–º–∞—Ä–∫–∞–Ω–¥ ‚Üí –ê—ç—Ä–æ–ø–æ—Ä—Ç (SEDAN)',
            from: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ (—Ü–µ–Ω—Ç—Ä)',
            to: '–ê—ç—Ä–æ–ø–æ—Ä—Ç',
            vehicle: 'SEDAN'
          },
          {
            title: 'üè∑Ô∏è –§–∏–∫—Å: –°–∞–º–∞—Ä–∫–∞–Ω–¥ ‚Üí –≠–∫—Å–∫—É—Ä—Å–∏—è (PREMIUM)',
            from: '–°–∞–º–∞—Ä–∫–∞–Ω–¥ (—Ü–µ–Ω—Ç—Ä)',
            to: '–≠–∫—Å–∫—É—Ä—Å–∏—è –ø–æ –°–∞–º–∞—Ä–∫–∞–Ω–¥—É',
            vehicle: 'PREMIUM'
          }
        ];

        let results = 'üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:\n\n';

        for (const test of tests) {
          try {
            const data = await calculatePrice(test.from, test.to, test.vehicle);
            results += createPriceCard(data, test.title);
          } catch (error) {
            results += `<div class="price-card" style="border-color: #ef4444;">
                            <div class="price-title">${test.title}</div>
                            <div style="color: #dc2626;">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>
                        </div>`;
          }
        }

        results += `
                <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border: 1px solid #0ea5e9; border-radius: 8px;">
                    <h3 style="margin: 0 0 10px 0; color: #0c4a6e;">üìã –í—ã–≤–æ–¥—ã:</h3>
                    <ul style="margin: 0; color: #0c4a6e;">
                        <li><strong>–¢–∞—Ä–∏—Ñ—ã –∏–∑ –ë–î</strong> - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å (routeType: DATABASE)</li>
                        <li><strong>–•–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã</strong> - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ fallback (routeType: FIXED)</li>
                        <li><strong>–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è</strong> - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –±–∞–∑–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞</li>
                        <li><strong>–°—Ç—Ä–∞–Ω–∏—Ü–∞ booking</strong> —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—ã –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏! üéâ</li>
                    </ul>
                </div>
                `;

        showResult(results, 'success');
      } catch (error) {
        showResult(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:\n\n${error.message}`, 'error');
      }
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.onload = function () {
      showResult('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π.', 'loading');
    };
  </script>
</body>

</html>