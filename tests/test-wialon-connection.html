<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Wialon - gps.ent-en.com</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .status {
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
      font-weight: 500;
    }

    .status.loading {
      background: #e0f2fe;
      color: #0277bd;
      border: 1px solid #81d4fa;
    }

    .status.success {
      background: #e8f5e8;
      color: #2e7d32;
      border: 1px solid #81c784;
    }

    .status.error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ef9a9a;
    }

    .info-block {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
      border-left: 4px solid #007bff;
    }

    .vehicle-list {
      margin-top: 20px;
    }

    .vehicle-item {
      background: #f8f9fa;
      padding: 12px;
      margin: 8px 0;
      border-radius: 4px;
      border-left: 3px solid #28a745;
    }

    .vehicle-offline {
      border-left-color: #dc3545;
    }

    .btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }

    .btn:hover {
      background: #0056b3;
    }

    .btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }

    pre {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üîå –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Wialon</h1>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É: <strong>176.74.220.111</strong></p>

    <div class="info-block">
      <strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</strong><br>
      –°–µ—Ä–≤–µ—Ä: 176.74.220.111<br>
      –¢–æ–∫–µ–Ω: 85991e5f06896e98fe3c0bd49d2fe6d8EC2B0F5F2A7A963F0EC0B869EB87FF8188C6EE8D
    </div>

    <button class="btn" onclick="testConnection()">üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é</button>
    <button class="btn" onclick="testAllTokens()">üîë –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã</button>
    <button class="btn" onclick="testAllConfigs()">üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏</button>
    <button class="btn" onclick="testServerAvailability()">üåê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞</button>
    <button class="btn" onclick="getVehicles()" id="vehiclesBtn" disabled>üöå –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞</button>
    <button class="btn" onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>

    <div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px;">
      <strong>–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:</strong> <span id="currentConfig">HTTP + –¢–æ–∫–µ–Ω 1</span><br>
      <small>–í—Å–µ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π: <span id="totalConfigs">40</span> (5 URL √ó 8 —Ç–æ–∫–µ–Ω–æ–≤)</small>
    </div>

    <div id="status"></div>
    <div id="results"></div>
    <div id="log"></div>
  </div>

  <script>
    // –í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    const tokens = [
      '85991e5f06896e98fe3c0bd49d2fe6d8180CC6E50B57B93D4DEBC803DCA10911F8194C4C',
      '85991e5f06896e98fe3c0bd49d2fe6d81E788605DF95583FD8DDBFFC265EBDE983728755',
      '85991e5f06896e98fe3c0bd49d2fe6d81F89022B622B2C29F032B733A970E75BD5442A89',
      '85991e5f06896e98fe3c0bd49d2fe6d82EF1B79878B3945A64C4E9CF0B89A97BBE9859DC',
      '85991e5f06896e98fe3c0bd49d2fe6d87952655C715C1EEB7D785AECF9E97D45C2365196',
      '85991e5f06896e98fe3c0bd49d2fe6d88A480A15648C17B4F9820C17D612D39FF0416A36',
      '85991e5f06896e98fe3c0bd49d2fe6d8EC2B0F5F2A7A963F0EC0B869EB87FF8188C6EE8D',
      '85991e5f06896e98fe3c0bd49d2fe6d8FB33DD1867560C348D1E2840BE0227089280C386'
    ];

    // –ë–∞–∑–æ–≤—ã–µ URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    const baseUrls = [
      'http://176.74.220.111',
      'https://176.74.220.111',
      'http://176.74.220.111:8080',
      'http://176.74.220.111/wialon/ajax.html',
      'http://176.74.220.111:80'
    ];

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ URL + —Ç–æ–∫–µ–Ω
    const configs = [];
    baseUrls.forEach((baseUrl, urlIndex) => {
      tokens.forEach((token, tokenIndex) => {
        const urlName = baseUrl.includes(':8080') ? 'HTTP:8080' :
          baseUrl.includes('https') ? 'HTTPS' :
            baseUrl.includes('/wialon/ajax.html') ? 'HTTP –ø—Ä—è–º–æ–π' :
              baseUrl.includes(':80') ? 'HTTP:80' : 'HTTP';

        configs.push({
          name: `${urlName} + –¢–æ–∫–µ–Ω ${tokenIndex + 1}`,
          baseUrl: baseUrl,
          token: token,
          tokenIndex: tokenIndex + 1,
          urlIndex: urlIndex + 1
        });
      });
    });

    let currentConfigIndex = 0;
    let config = configs[currentConfigIndex];

    let session = null;

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
      logEntry.style.margin = '5px 0';
      logEntry.style.padding = '5px';
      logEntry.style.borderRadius = '3px';

      switch (type) {
        case 'error':
          logEntry.style.background = '#ffebee';
          logEntry.style.color = '#c62828';
          break;
        case 'success':
          logEntry.style.background = '#e8f5e8';
          logEntry.style.color = '#2e7d32';
          break;
        default:
          logEntry.style.background = '#f8f9fa';
          logEntry.style.color = '#495057';
      }

      logDiv.appendChild(logEntry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function showStatus(message, type) {
      const statusDiv = document.getElementById('status');
      statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
    }

    async function makeRequest(svc, params = {}) {
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL
      let baseApiUrl;
      if (config.baseUrl.includes('/wialon/ajax.html')) {
        baseApiUrl = config.baseUrl;
      } else {
        baseApiUrl = `${config.baseUrl}/wialon/ajax.html`;
      }

      const url = new URL(baseApiUrl);
      url.searchParams.set('svc', svc);

      if (session) {
        url.searchParams.set('sid', session.sid);
      }

      const body = new URLSearchParams();
      body.append('params', JSON.stringify(params));

      log(`–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: ${config.name}`);
      log(`–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${svc}`);
      log(`URL: ${url.toString()}`);
      log(`–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: ${JSON.stringify(params)}`);

      try {
        const response = await fetch(url.toString(), {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: body.toString()
        });

        log(`–°—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞: ${response.status} ${response.statusText}`);

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        log(`–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω: ${JSON.stringify(data, null, 2)}`);
        return data;
      } catch (error) {
        log(`–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');
        throw error;
      }
    }

    // –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    async function testServerAvailability() {
      log('=== –¢–ï–°–¢ –î–û–°–¢–£–ü–ù–û–°–¢–ò –°–ï–†–í–ï–†–ê ===');

      const testUrls = [
        'http://176.74.220.111',
        'https://176.74.220.111',
        'http://176.74.220.111:8080',
        'http://176.74.220.111/wialon',
        'http://176.74.220.111:80'
      ];

      for (const testUrl of testUrls) {
        try {
          log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏: ${testUrl}`);
          const response = await fetch(testUrl, {
            method: 'HEAD',
            mode: 'no-cors' // –û–±—Ö–æ–¥–∏–º CORS –¥–ª—è –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
          });
          log(`‚úÖ ${testUrl} - –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
        } catch (error) {
          log(`‚ùå ${testUrl} - –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`, 'error');
        }
      }
    }

    async function testAllTokens() {
      log('=== –¢–ï–°–¢ –í–°–ï–• –¢–û–ö–ï–ù–û–í –° HTTP ===');
      showStatus('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö 8 —Ç–æ–∫–µ–Ω–æ–≤...', 'loading');

      const baseUrl = 'http://176.74.220.111';

      for (let i = 0; i < tokens.length; i++) {
        const token = tokens[i];
        const testConfig = {
          name: `HTTP + –¢–æ–∫–µ–Ω ${i + 1}`,
          baseUrl: baseUrl,
          token: token,
          tokenIndex: i + 1
        };

        config = testConfig;
        document.getElementById('currentConfig').textContent = config.name;

        log(`\n--- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ ${i + 1}/8 ---`);
        log(`–¢–æ–∫–µ–Ω: ${token.substring(0, 20)}...${token.substring(token.length - 10)}`);

        try {
          session = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–µ—Å—Å–∏—é
          await testConnectionSilent();
          log(`‚úÖ –¢–æ–∫–µ–Ω ${i + 1} —Ä–∞–±–æ—Ç–∞–µ—Ç!`, 'success');
          showStatus(`‚úÖ –ù–∞–π–¥–µ–Ω —Ä–∞–±–æ—á–∏–π —Ç–æ–∫–µ–Ω ${i + 1}!`, 'success');
          document.getElementById('vehiclesBtn').disabled = false;
          return; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º —Ä–∞–±–æ—á–µ–º —Ç–æ–∫–µ–Ω–µ
        } catch (error) {
          log(`‚ùå –¢–æ–∫–µ–Ω ${i + 1} –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}`, 'error');
        }

        // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
        await new Promise(resolve => setTimeout(resolve, 500));
      }

      showStatus('‚ùå –ù–∏ –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
      log('=== –í–°–ï –¢–û–ö–ï–ù–´ –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–´ ===', 'error');
    }

    async function testAllConfigs() {
      log('=== –¢–ï–°–¢ –í–°–ï–• –ö–û–ú–ë–ò–ù–ê–¶–ò–ô (URL + –¢–û–ö–ï–ù–´) ===');
      showStatus('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö 40 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π...', 'loading');

      for (let i = 0; i < configs.length; i++) {
        currentConfigIndex = i;
        config = configs[i];
        document.getElementById('currentConfig').textContent = config.name;

        log(`\n--- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ${i + 1}/${configs.length}: ${config.name} ---`);

        try {
          session = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–µ—Å—Å–∏—é
          await testConnectionSilent();
          log(`‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è "${config.name}" —Ä–∞–±–æ—Ç–∞–µ—Ç!`, 'success');
          showStatus(`‚úÖ –ù–∞–π–¥–µ–Ω–∞ —Ä–∞–±–æ—á–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: ${config.name}`, 'success');
          document.getElementById('vehiclesBtn').disabled = false;
          return; // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–π —Ä–∞–±–æ—á–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        } catch (error) {
          log(`‚ùå ${config.name}: ${error.message}`, 'error');
        }

        // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
        await new Promise(resolve => setTimeout(resolve, 300));
      }

      showStatus('‚ùå –ù–∏ –æ–¥–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
      log('=== –í–°–ï –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò –ü–†–û–¢–ï–°–¢–ò–†–û–í–ê–ù–´ ===', 'error');
    }

    // –¢–∏—Ö–∞—è –≤–µ—Ä—Å–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–±–µ–∑ –ª–∏—à–Ω–∏—Ö –ª–æ–≥–æ–≤)
    async function testConnectionSilent() {
      const loginResponse = await makeRequestSilent('token/login', {
        token: config.token
      });

      if (loginResponse.error) {
        throw new Error(`–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${loginResponse.error}`);
      }

      session = {
        sid: loginResponse.eid,
        userId: loginResponse.user?.id || 0,
        userName: loginResponse.user?.nm || 'Unknown'
      };

      return session;
    }

    // –¢–∏—Ö–∞—è –≤–µ—Ä—Å–∏—è –∑–∞–ø—Ä–æ—Å–∞ (–±–µ–∑ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –ª–æ–≥–æ–≤)
    async function makeRequestSilent(svc, params = {}) {
      let baseApiUrl;
      if (config.baseUrl.includes('/wialon/ajax.html')) {
        baseApiUrl = config.baseUrl;
      } else {
        baseApiUrl = `${config.baseUrl}/wialon/ajax.html`;
      }

      const url = new URL(baseApiUrl);
      url.searchParams.set('svc', svc);

      if (session) {
        url.searchParams.set('sid', session.sid);
      }

      const body = new URLSearchParams();
      body.append('params', JSON.stringify(params));

      const response = await fetch(url.toString(), {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: body.toString()
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      return await response.json();
    }

    async function testConnection() {
      showStatus('üîÑ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Wialon...', 'loading');
      log('=== –ù–ê–ß–ê–õ–û –¢–ï–°–¢–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø ===');

      try {
        // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞
        log('–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞...');

        // –¢–µ—Å—Ç 2: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        log('–®–∞–≥ 2: –ü–æ–ø—ã—Ç–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏...');
        const loginResponse = await makeRequest('token/login', {
          token: config.token
        });

        if (loginResponse.error) {
          throw new Error(`–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${loginResponse.error}`);
        }

        session = {
          sid: loginResponse.eid,
          userId: loginResponse.user?.id || 0,
          userName: loginResponse.user?.nm || 'Unknown'
        };

        log(`–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! SID: ${session.sid}`, 'success');
        log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${session.userName} (ID: ${session.userId})`, 'success');

        // –¢–µ—Å—Ç 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–æ–∫–∞–ª–∏
        log('–®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞...');
        const tzOffset = new Date().getTimezoneOffset() * -60;
        await makeRequest('render/set_locale', {
          tzOffset,
          language: 'ru'
        });

        showStatus('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Wialon —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
        document.getElementById('vehiclesBtn').disabled = false;

        log('=== –¢–ï–°–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù –£–°–ü–ï–®–ù–û ===', 'success');

      } catch (error) {
        showStatus(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
        log(`–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê: ${error.message}`, 'error');
        log('=== –¢–ï–°–¢ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ü–†–û–í–ê–õ–ï–ù ===', 'error');
      }
    }

    async function getVehicles() {
      if (!session) {
        showStatus('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ', 'error');
        return;
      }

      showStatus('üîÑ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞...', 'loading');
      log('=== –ü–û–õ–£–ß–ï–ù–ò–ï –°–ü–ò–°–ö–ê –¢–†–ê–ù–°–ü–û–†–¢–ê ===');

      try {
        // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
        const searchResponse = await makeRequest('core/search_items', {
          spec: {
            itemsType: 'avl_unit',
            propName: 'sys_name',
            propValueMask: '*',
            sortType: 'sys_name'
          },
          force: 1,
          flags: 0x1,
          from: 0,
          to: 0
        });

        const vehicles = searchResponse.items || [];
        log(`–ù–∞–π–¥–µ–Ω–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤: ${vehicles.length}`, 'success');

        if (vehicles.length === 0) {
          showStatus('‚ö†Ô∏è –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'error');
          return;
        }

        // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–∑–∏—Ü–∏—è—Ö
        log('–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∑–∏—Ü–∏—è—Ö...');
        const vehicleIds = vehicles.map(v => v.id);

        const updateResponse = await makeRequest('core/update_data_flags', {
          spec: vehicleIds.map(id => ({
            type: 'id',
            data: id,
            flags: 0x1 | 0x2 // –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è + –ø–æ–∑–∏—Ü–∏—è
          }))
        });

        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        displayVehicles(vehicles);
        showStatus(`‚úÖ –ü–æ–ª—É—á–µ–Ω–æ ${vehicles.length} —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤`, 'success');

        log('=== –°–ü–ò–°–û–ö –¢–†–ê–ù–°–ü–û–†–¢–ê –ü–û–õ–£–ß–ï–ù –£–°–ü–ï–®–ù–û ===', 'success');

      } catch (error) {
        showStatus(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
        log(`–û–®–ò–ë–ö–ê: ${error.message}`, 'error');
      }
    }

    function displayVehicles(vehicles) {
      const resultsDiv = document.getElementById('results');

      let html = '<div class="vehicle-list"><h3>üöå –°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤:</h3>';

      vehicles.forEach((vehicle, index) => {
        const pos = vehicle.pos;
        const isOnline = pos && (Math.floor(Date.now() / 1000) - pos.t) < 600; // 10 –º–∏–Ω—É—Ç
        const speed = pos?.s || 0;
        const status = !isOnline ? '–û—Ñ—Ñ–ª–∞–π–Ω' : speed > 5 ? '–í –¥–≤–∏–∂–µ–Ω–∏–∏' : '–û—Å—Ç–∞–Ω–æ–≤–∫–∞';

        html += `
                    <div class="vehicle-item ${!isOnline ? 'vehicle-offline' : ''}">
                        <strong>${vehicle.nm || `–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç ${vehicle.id}`}</strong><br>
                        <small>
                            ID: ${vehicle.id} | 
                            –°—Ç–∞—Ç—É—Å: ${status} | 
                            –°–∫–æ—Ä–æ—Å—Ç—å: ${speed} –∫–º/—á<br>
                            ${pos ? `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${pos.y?.toFixed(6)}, ${pos.x?.toFixed(6)}` : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∑–∏—Ü–∏–∏'}<br>
                            ${pos ? `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${new Date(pos.t * 1000).toLocaleString()}` : ''}
                        </small>
                    </div>
                `;
      });

      html += '</div>';
      resultsDiv.innerHTML = html;
    }

    function clearLog() {
      document.getElementById('log').innerHTML = '';
      document.getElementById('results').innerHTML = '';
      document.getElementById('status').innerHTML = '';
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.onload = function () {
      log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Wialon.');
      log(`–î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤: ${tokens.length}`);
      log(`–î–æ—Å—Ç—É–ø–Ω–æ URL: ${baseUrls.length}`);
      log(`–í—Å–µ–≥–æ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π: ${configs.length}`);
      log(`–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: ${config.name}`);
      log(`–°–µ—Ä–≤–µ—Ä: ${config.baseUrl}`);
      log(`–¢–æ–∫–µ–Ω: ${config.token.substring(0, 20)}...${config.token.substring(config.token.length - 10)}`);

      document.getElementById('currentConfig').textContent = config.name;
      document.getElementById('totalConfigs').textContent = configs.length;
    };
  </script>
</body>

</html>