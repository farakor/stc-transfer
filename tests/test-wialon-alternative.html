<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Wialon</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .status {
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
      font-weight: 500;
    }

    .status.loading {
      background: #e0f2fe;
      color: #0277bd;
      border: 1px solid #81d4fa;
    }

    .status.success {
      background: #e8f5e8;
      color: #2e7d32;
      border: 1px solid #81c784;
    }

    .status.error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ef9a9a;
    }

    .warning-block {
      background: #fff3cd;
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
      border-left: 4px solid #ffc107;
      color: #856404;
    }

    .info-block {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 6px;
      margin: 15px 0;
      border-left: 4px solid #2196f3;
    }

    .btn {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
      font-weight: 500;
    }

    .btn:hover {
      background: #0056b3;
    }

    .btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }

    .btn.success {
      background: #28a745;
    }

    .btn.warning {
      background: #ffc107;
      color: #212529;
    }

    .method-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin: 15px 0;
      border: 1px solid #dee2e6;
    }

    .method-card h4 {
      margin: 0 0 10px 0;
      color: #495057;
    }

    .test-result {
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      font-size: 14px;
    }

    .test-result.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .test-result.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .test-result.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    pre {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 11px;
      max-height: 200px;
      overflow-y: auto;
    }

    .form-group {
      margin: 15px 0;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }

    .form-group textarea {
      height: 100px;
      resize: vertical;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Wialon</h1>
    <p>–ü–æ—Å–∫–æ–ª—å–∫—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏, –ø–æ–ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã</p>

    <div class="warning-block">
      <strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –í—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É 176.74.220.111 –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç.<br>
      <strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:</strong> CORS, –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä, –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞, –∏–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–∫—Å–∏.
    </div>

    <!-- –ú–µ—Ç–æ–¥ 1: JSONP -->
    <div class="method-card">
      <h4>üîÑ –ú–µ—Ç–æ–¥ 1: JSONP (–æ–±—Ö–æ–¥ CORS)</h4>
      <p>–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ JSONP –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π CORS</p>
      <button class="btn" onclick="testJSONP()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å JSONP</button>
      <div id="jsonpResult"></div>
    </div>

    <!-- –ú–µ—Ç–æ–¥ 2: –ü—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä -->
    <div class="method-card">
      <h4>üåê –ú–µ—Ç–æ–¥ 2: –ß–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä</h4>
      <p>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ CORS-–ø—Ä–æ–∫—Å–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</p>
      <button class="btn" onclick="testProxy()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏</button>
      <div id="proxyResult"></div>
    </div>

    <!-- –ú–µ—Ç–æ–¥ 3: WebSocket -->
    <div class="method-card">
      <h4>‚ö° –ú–µ—Ç–æ–¥ 3: WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</h4>
      <p>–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)</p>
      <button class="btn" onclick="testWebSocket()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å WebSocket</button>
      <div id="websocketResult"></div>
    </div>

    <!-- –ú–µ—Ç–æ–¥ 4: Server-Sent Events -->
    <div class="method-card">
      <h4>üì° –ú–µ—Ç–æ–¥ 4: Server-Sent Events</h4>
      <p>–ü–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ SSE</p>
      <button class="btn" onclick="testSSE()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å SSE</button>
      <div id="sseResult"></div>
    </div>

    <!-- –ú–µ—Ç–æ–¥ 5: –ü—Ä—è–º–æ–π HTTP –±–µ–∑ AJAX -->
    <div class="method-card">
      <h4>üîó –ú–µ—Ç–æ–¥ 5: –ü—Ä—è–º–æ–π HTTP –∑–∞–ø—Ä–æ—Å</h4>
      <p>–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–ª—è –ø—Ä—è–º–æ–≥–æ POST –∑–∞–ø—Ä–æ—Å–∞</p>
      <button class="btn" onclick="testDirectHTTP()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä—è–º–æ–π HTTP</button>
      <div id="directResult"></div>
    </div>

    <!-- –ú–µ—Ç–æ–¥ 6: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–∫—Å–∏ -->
    <div class="method-card">
      <h4>üõ†Ô∏è –ú–µ—Ç–æ–¥ 6: –õ–æ–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä</h4>
      <p>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞</p>
      <div class="info-block">
        <strong>–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä:</strong><br>
        1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js<br>
        2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª proxy-server.js<br>
        3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ: node proxy-server.js<br>
        4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ http://localhost:3001 –∫–∞–∫ –ø—Ä–æ–∫—Å–∏
      </div>
      <button class="btn warning" onclick="showProxyCode()">–ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥ –ø—Ä–æ–∫—Å–∏</button>
      <div id="proxyCode" style="display: none;">
        <pre id="proxyCodeContent"></pre>
      </div>
    </div>

    <!-- –ú–µ—Ç–æ–¥ 7: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –¥–æ–º–µ–Ω—ã -->
    <div class="method-card">
      <h4>üåç –ú–µ—Ç–æ–¥ 7: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –¥–æ–º–µ–Ω—ã/IP</h4>
      <div class="form-group">
        <label>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL:</label>
        <input type="text" id="altUrl" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: wialon.your-domain.com" />
      </div>
      <button class="btn" onclick="testAlternativeUrl()">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL</button>
      <div id="altUrlResult"></div>
    </div>

    <!-- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ -->
    <div class="method-card">
      <h4>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏</h4>
      <button class="btn" onclick="runNetworkDiagnostics()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>
      <div id="diagnosticsResult"></div>
    </div>

    <!-- –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å -->
    <div id="status"></div>
    <div id="log"></div>
  </div>

  <script>
    const credentials = {
      username: 'AKhamraev',
      password: 'xamrayev11'
    };

    const baseServer = '176.74.220.111';

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
      logEntry.style.margin = '2px 0';
      logEntry.style.padding = '3px';
      logEntry.style.borderRadius = '3px';
      logEntry.style.fontSize = '12px';

      switch (type) {
        case 'error':
          logEntry.style.background = '#ffebee';
          logEntry.style.color = '#c62828';
          break;
        case 'success':
          logEntry.style.background = '#e8f5e8';
          logEntry.style.color = '#2e7d32';
          break;
        default:
          logEntry.style.background = '#f8f9fa';
          logEntry.style.color = '#495057';
      }

      logDiv.appendChild(logEntry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function showResult(elementId, message, type) {
      const element = document.getElementById(elementId);
      element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
    }

    // –ú–µ—Ç–æ–¥ 1: JSONP
    function testJSONP() {
      log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSONP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
      showResult('jsonpResult', 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JSONP...', 'info');

      // JSONP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å POST –∑–∞–ø—Ä–æ—Å–∞–º–∏, –Ω–æ –º–æ–∂–µ–º –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å GET
      const script = document.createElement('script');
      const callbackName = 'wialonCallback' + Date.now();

      window[callbackName] = function (data) {
        log('JSONP –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω', 'success');
        showResult('jsonpResult', '‚úÖ JSONP —Ä–∞–±–æ—Ç–∞–µ—Ç! –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç.', 'success');
        document.head.removeChild(script);
        delete window[callbackName];
      };

      script.onerror = function () {
        log('JSONP –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
        showResult('jsonpResult', '‚ùå JSONP –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
        document.head.removeChild(script);
        delete window[callbackName];
      };

      script.src = `http://${baseServer}/wialon/ajax.html?svc=core/login&callback=${callbackName}`;
      document.head.appendChild(script);

      // –¢–∞–π–º–∞—É—Ç
      setTimeout(() => {
        if (document.head.contains(script)) {
          document.head.removeChild(script);
          delete window[callbackName];
          showResult('jsonpResult', '‚ùå JSONP —Ç–∞–π–º–∞—É—Ç', 'error');
        }
      }, 10000);
    }

    // –ú–µ—Ç–æ–¥ 2: –ü—Ä–æ–∫—Å–∏
    async function testProxy() {
      log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ CORS –ø—Ä–æ–∫—Å–∏...');
      showResult('proxyResult', 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏...', 'info');

      const proxies = [
        'https://cors-anywhere.herokuapp.com/',
        'https://api.allorigins.win/raw?url=',
        'https://corsproxy.io/?'
      ];

      for (const proxy of proxies) {
        try {
          log(`–ü–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏: ${proxy}`);

          const url = `${proxy}http://${baseServer}/wialon/ajax.html?svc=core/login`;
          const body = new URLSearchParams();
          body.append('params', JSON.stringify({
            user: credentials.username,
            password: credentials.password
          }));

          const response = await fetch(url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: body.toString()
          });

          if (response.ok) {
            const data = await response.json();
            log(`–ü—Ä–æ–∫—Å–∏ ${proxy} —Ä–∞–±–æ—Ç–∞–µ—Ç!`, 'success');
            showResult('proxyResult', `‚úÖ –ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${proxy}`, 'success');
            return;
          }
        } catch (error) {
          log(`–ü—Ä–æ–∫—Å–∏ ${proxy} –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}`, 'error');
        }
      }

      showResult('proxyResult', '‚ùå –ù–∏ –æ–¥–∏–Ω –ø—Ä–æ–∫—Å–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
    }

    // –ú–µ—Ç–æ–¥ 3: WebSocket
    function testWebSocket() {
      log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...');
      showResult('websocketResult', 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket...', 'info');

      const wsUrls = [
        `ws://${baseServer}:80`,
        `ws://${baseServer}:8080`,
        `wss://${baseServer}:443`,
        `wss://${baseServer}:8443`
      ];

      let tested = 0;
      let success = false;

      wsUrls.forEach(url => {
        const ws = new WebSocket(url);

        ws.onopen = function () {
          log(`WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: ${url}`, 'success');
          showResult('websocketResult', `‚úÖ WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç: ${url}`, 'success');
          success = true;
          ws.close();
        };

        ws.onerror = function () {
          tested++;
          if (tested === wsUrls.length && !success) {
            showResult('websocketResult', '‚ùå WebSocket –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
          }
        };

        // –¢–∞–π–º–∞—É—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        setTimeout(() => {
          if (ws.readyState === WebSocket.CONNECTING) {
            ws.close();
          }
        }, 5000);
      });
    }

    // –ú–µ—Ç–æ–¥ 4: Server-Sent Events
    function testSSE() {
      log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Server-Sent Events...');
      showResult('sseResult', 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SSE...', 'info');

      try {
        const eventSource = new EventSource(`http://${baseServer}/wialon/ajax.html?svc=core/login`);

        eventSource.onopen = function () {
          log('SSE –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', 'success');
          showResult('sseResult', '‚úÖ SSE —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
          eventSource.close();
        };

        eventSource.onerror = function () {
          log('SSE –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'error');
          showResult('sseResult', '‚ùå SSE –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'error');
          eventSource.close();
        };

        // –¢–∞–π–º–∞—É—Ç
        setTimeout(() => {
          eventSource.close();
        }, 10000);
      } catch (error) {
        showResult('sseResult', `‚ùå SSE –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
      }
    }

    // –ú–µ—Ç–æ–¥ 5: –ü—Ä—è–º–æ–π HTTP
    function testDirectHTTP() {
      log('–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä—è–º–æ–≥–æ HTTP –∑–∞–ø—Ä–æ—Å–∞...');
      showResult('directResult', 'üîÑ –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–ª—è –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞...', 'info');

      // –°–æ–∑–¥–∞–µ–º —Å–∫—Ä—ã—Ç—É—é —Ñ–æ—Ä–º—É
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = `http://${baseServer}/wialon/ajax.html?svc=core/login`;
      form.target = '_blank';
      form.style.display = 'none';

      const paramsInput = document.createElement('input');
      paramsInput.type = 'hidden';
      paramsInput.name = 'params';
      paramsInput.value = JSON.stringify({
        user: credentials.username,
        password: credentials.password
      });

      form.appendChild(paramsInput);
      document.body.appendChild(form);

      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º—É
      form.submit();

      showResult('directResult', '‚úÖ –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.', 'success');

      // –£–¥–∞–ª—è–µ–º —Ñ–æ—Ä–º—É
      setTimeout(() => {
        document.body.removeChild(form);
      }, 1000);
    }

    // –ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–¥ –ø—Ä–æ–∫—Å–∏
    function showProxyCode() {
      const proxyCode = `
const express = require('express');
const { createProxyMiddleware } = require('http-proxy-middleware');
const cors = require('cors');

const app = express();

// –í–∫–ª—é—á–∞–µ–º CORS –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
app.use(cors());

// –ü—Ä–æ–∫—Å–∏ –¥–ª—è Wialon API
app.use('/wialon', createProxyMiddleware({
  target: 'http://176.74.220.111',
  changeOrigin: true,
  pathRewrite: {
    '^/wialon': '/wialon'
  }
}));

app.listen(3001, () => {
  console.log('–ü—Ä–æ–∫—Å–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:3001');
  console.log('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ http://localhost:3001/wialon/ajax.html –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
});

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
// npm install express http-proxy-middleware cors
      `;

      document.getElementById('proxyCodeContent').textContent = proxyCode;
      document.getElementById('proxyCode').style.display = 'block';
    }

    // –¢–µ—Å—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ URL
    async function testAlternativeUrl() {
      const altUrl = document.getElementById('altUrl').value.trim();
      if (!altUrl) {
        showResult('altUrlResult', '‚ùå –í–≤–µ–¥–∏—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL', 'error');
        return;
      }

      log(`–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ URL: ${altUrl}`);
      showResult('altUrlResult', `üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ${altUrl}...`, 'info');

      try {
        const response = await fetch(`${altUrl}/wialon/ajax.html?svc=core/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
          },
          body: `params=${JSON.stringify({
            user: credentials.username,
            password: credentials.password
          })}`
        });

        if (response.ok) {
          const data = await response.json();
          log(`–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL —Ä–∞–±–æ—Ç–∞–µ—Ç!`, 'success');
          showResult('altUrlResult', `‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL —Ä–∞–±–æ—Ç–∞–µ—Ç!`, 'success');
        } else {
          throw new Error(`HTTP ${response.status}`);
        }
      } catch (error) {
        log(`–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π URL –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}`, 'error');
        showResult('altUrlResult', `‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}`, 'error');
      }
    }

    // –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏
    async function runNetworkDiagnostics() {
      log('–ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ —Å–µ—Ç–∏...');
      showResult('diagnosticsResult', 'üîÑ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏...', 'info');

      let diagnostics = '<div class="test-result info"><strong>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–µ—Ç–∏:</strong><br>';

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–µ –º–µ—Ç–æ–¥—ã
      const tests = [
        { name: 'Ping —á–µ—Ä–µ–∑ fetch HEAD', url: `http://${baseServer}`, method: 'HEAD' },
        { name: 'Ping —á–µ—Ä–µ–∑ fetch GET', url: `http://${baseServer}`, method: 'GET' },
        { name: 'HTTPS –ø—Ä–æ–≤–µ—Ä–∫–∞', url: `https://${baseServer}`, method: 'HEAD' },
        { name: '–ü–æ—Ä—Ç 8080', url: `http://${baseServer}:8080`, method: 'HEAD' },
        { name: 'Wialon –ø—É—Ç—å', url: `http://${baseServer}/wialon`, method: 'HEAD' }
      ];

      for (const test of tests) {
        try {
          const response = await fetch(test.url, {
            method: test.method,
            mode: 'no-cors',
            cache: 'no-cache'
          });
          diagnostics += `‚úÖ ${test.name}: –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω<br>`;
        } catch (error) {
          diagnostics += `‚ùå ${test.name}: ${error.message}<br>`;
        }
      }

      // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ
      diagnostics += `<br><strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–∞—É–∑–µ—Ä–µ:</strong><br>`;
      diagnostics += `User Agent: ${navigator.userAgent}<br>`;
      diagnostics += `–Ø–∑—ã–∫: ${navigator.language}<br>`;
      diagnostics += `–û–Ω–ª–∞–π–Ω: ${navigator.onLine}<br>`;
      diagnostics += `Cookies –≤–∫–ª—é—á–µ–Ω—ã: ${navigator.cookieEnabled}<br>`;

      diagnostics += '</div>';
      showResult('diagnosticsResult', diagnostics, 'info');
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.onload = function () {
      log('–°–∏—Å—Ç–µ–º–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≥–æ—Ç–æ–≤–∞');
      log(`–¶–µ–ª—å: –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É ${baseServer}`);
      log(`–£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: ${credentials.username} / ${credentials.password}`);
    };
  </script>
</body>

</html>