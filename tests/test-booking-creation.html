<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-8">
  <div class="max-w-2xl mx-auto">
    <h1 class="text-3xl font-bold mb-8 text-center">üöó –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞</h1>

    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑</h2>
      <form id="bookingForm" class="space-y-4">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">–û—Ç–∫—É–¥–∞</label>
            <input type="text" id="fromLocation" value="–¢–∞—à–∫–µ–Ω—Ç" class="w-full border rounded px-3 py-2" required>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">–ö—É–¥–∞</label>
            <input type="text" id="toLocation" value="–°–∞–º–∞—Ä–∫–∞–Ω–¥" class="w-full border rounded px-3 py-2" required>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">–¢–∏–ø –∞–≤—Ç–æ–º–æ–±–∏–ª—è</label>
            <select id="vehicleType" class="w-full border rounded px-3 py-2" required>
              <option value="SEDAN">–°–µ–¥–∞–Ω</option>
              <option value="PREMIUM">–ü—Ä–µ–º–∏—É–º</option>
              <option value="MINIVAN" selected>–ú–∏–Ω–∏–≤—ç–Ω</option>
              <option value="MICROBUS">–ú–∏–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å</option>
              <option value="BUS">–ê–≤—Ç–æ–±—É—Å</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Telegram ID</label>
            <input type="number" id="telegramId" value="123456789" class="w-full border rounded px-3 py-2" required>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)</label>
          <input type="number" id="distanceKm" value="280" class="w-full border rounded px-3 py-2">
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</label>
          <textarea id="notes" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è..."
            class="w-full border rounded px-3 py-2 h-20"></textarea>
        </div>

        <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600 transition-colors">
          –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
        </button>
      </form>
    </div>

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div id="result" class="bg-white rounded-lg shadow-md p-6 hidden">
      <h3 class="text-lg font-semibold mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç</h3>
      <div id="resultContent"></div>
    </div>

    <!-- –õ–æ–≥ -->
    <div class="bg-gray-900 text-green-400 rounded-lg p-4">
      <h3 class="text-lg font-semibold mb-2">üìä –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
      <div id="log" class="text-sm font-mono max-h-60 overflow-y-auto"></div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:3003/api';

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    function log(message, type = 'info') {
      const logElement = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const colors = {
        info: 'text-green-400',
        error: 'text-red-400',
        success: 'text-blue-400',
        warning: 'text-yellow-400'
      };
      logElement.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
      logElement.scrollTop = logElement.scrollHeight;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
    document.getElementById('bookingForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = {
        telegramId: parseInt(document.getElementById('telegramId').value),
        fromLocation: document.getElementById('fromLocation').value,
        toLocation: document.getElementById('toLocation').value,
        vehicleType: document.getElementById('vehicleType').value,
        distanceKm: parseFloat(document.getElementById('distanceKm').value) || undefined,
        notes: document.getElementById('notes').value || undefined
      };

      log(`üöÄ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞: ${JSON.stringify(formData)}`, 'info');

      try {
        const response = await fetch(`${API_BASE}/bookings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        const data = await response.json();

        log(`üì® –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞ (${response.status}): ${JSON.stringify(data)}`, response.ok ? 'success' : 'error');

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        const resultDiv = document.getElementById('result');
        const resultContent = document.getElementById('resultContent');

        if (response.ok && data.success) {
          resultContent.innerHTML = `
                        <div class="text-green-600">
                            <h4 class="font-semibold mb-2">‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!</h4>
                            <div class="space-y-2 text-sm">
                                <p><strong>ID:</strong> ${data.data.id}</p>
                                <p><strong>–ú–∞—Ä—à—Ä—É—Ç:</strong> ${data.data.fromLocation} ‚Üí ${data.data.toLocation}</p>
                                <p><strong>–¢–∏–ø –∞–≤—Ç–æ–º–æ–±–∏–ª—è:</strong> ${data.data.vehicleType || '–ù–µ —É–∫–∞–∑–∞–Ω'}</p>
                                <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${data.data.status}</p>
                                <p><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ${Number(data.data.price).toLocaleString()} —Å—É–º</p>
                                <p><strong>–ê–≤—Ç–æ–º–æ–±–∏–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω:</strong> ${data.data.vehicle ? '–î–∞' : '–ù–µ—Ç'}</p>
                                <p><strong>–í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω:</strong> ${data.data.driver ? '–î–∞' : '–ù–µ—Ç'}</p>
                            </div>
                        </div>
                    `;
        } else {
          resultContent.innerHTML = `
                        <div class="text-red-600">
                            <h4 class="font-semibold mb-2">‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞</h4>
                            <p class="text-sm">${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>
                        </div>
                    `;
        }

        resultDiv.classList.remove('hidden');

      } catch (error) {
        log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${error.message}`, 'error');

        const resultDiv = document.getElementById('result');
        const resultContent = document.getElementById('resultContent');

        resultContent.innerHTML = `
                    <div class="text-red-600">
                        <h4 class="font-semibold mb-2">‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</h4>
                        <p class="text-sm">${error.message}</p>
                    </div>
                `;

        resultDiv.classList.remove('hidden');
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.onload = function () {
      log('üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'info');
      log('üì° API URL: ' + API_BASE, 'info');
    };
  </script>
</body>

</html>