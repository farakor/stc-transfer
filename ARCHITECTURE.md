# ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ STC Transfer

## ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

```
                                 Internet
                                    â†“
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚  DNS Server   â”‚
                            â”‚ srs.faruk.io  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      Ubuntu 24.04 Server      â”‚
                    â”‚     IP: your-server-ip        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      Firewall (UFW)           â”‚
                    â”‚  Ports: 80, 443, 22           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Nginx (Reverse Proxy)       â”‚
                    â”‚   + SSL/TLS (Let's Encrypt)   â”‚
                    â”‚   Port: 443 (HTTPS)           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â†“                               â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Frontend   â”‚              â”‚     Backend      â”‚
    â”‚  Static Filesâ”‚              â”‚   Node.js + PM2  â”‚
    â”‚ (Vite build) â”‚              â”‚   Port: 3001     â”‚
    â”‚              â”‚              â”‚   (Cluster: 2)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â†“              â†“              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  PostgreSQL  â”‚  â”‚Socket.IOâ”‚  â”‚   Telegram   â”‚
                    â”‚   Database   â”‚  â”‚WebSocketâ”‚  â”‚  Bot API     â”‚
                    â”‚  Port: 5432  â”‚  â”‚         â”‚  â”‚  (Webhook)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### 1. Ğ¤Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´ ÑĞ»Ğ¾Ğ¹ (Frontend Layer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Frontend Application                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ React + TypeScript                          â”‚
â”‚  â€¢ Vite build system                           â”‚
â”‚  â€¢ Static files served by Nginx                â”‚
â”‚  â€¢ Location: /home/stc/apps/stc-transfer/      â”‚
â”‚              frontend/dist/                     â”‚
â”‚  â€¢ Cache: 1 year for assets                    â”‚
â”‚  â€¢ No cache for HTML                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ĞŸÑ€Ğ¾ĞºÑĞ¸ ÑĞ»Ğ¾Ğ¹ (Proxy Layer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Nginx Reverse Proxy                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Routes:                                        â”‚
â”‚  â€¢ /              â†’ Frontend (static files)    â”‚
â”‚  â€¢ /api           â†’ Backend (port 3001)        â”‚
â”‚  â€¢ /socket.io     â†’ WebSocket (port 3001)      â”‚
â”‚  â€¢ /api/telegram  â†’ Telegram webhook           â”‚
â”‚                                                 â”‚
â”‚  Features:                                      â”‚
â”‚  â€¢ SSL/TLS termination                         â”‚
â”‚  â€¢ Gzip compression                            â”‚
â”‚  â€¢ Security headers                            â”‚
â”‚  â€¢ Request buffering                           â”‚
â”‚  â€¢ Access restrictions (Telegram IPs)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Ğ‘ÑĞºĞµĞ½Ğ´ ÑĞ»Ğ¾Ğ¹ (Backend Layer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Backend Application (PM2)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Instance 1              Instance 2             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ Express.js  â”‚        â”‚ Express.js  â”‚        â”‚
â”‚  â”‚ + TypeScriptâ”‚        â”‚ + TypeScriptâ”‚        â”‚
â”‚  â”‚             â”‚        â”‚             â”‚        â”‚
â”‚  â”‚ REST API    â”‚        â”‚ REST API    â”‚        â”‚
â”‚  â”‚ Socket.IO   â”‚        â”‚ Socket.IO   â”‚        â”‚
â”‚  â”‚ Telegram Botâ”‚        â”‚ Telegram Botâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                 â”‚
â”‚  â€¢ Cluster mode (2 instances)                  â”‚
â”‚  â€¢ Auto-restart on crash                       â”‚
â”‚  â€¢ Memory limit: 500MB per instance            â”‚
â”‚  â€¢ Load balancing by PM2                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Database Layer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            PostgreSQL Database                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Database: stc_transfer                        â”‚
â”‚  User: stc_user                                â”‚
â”‚  Port: 5432 (localhost only)                   â”‚
â”‚                                                 â”‚
â”‚  Tables:                                        â”‚
â”‚  â€¢ User (Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸)                         â”‚
â”‚  â€¢ Driver (Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ¸)                           â”‚
â”‚  â€¢ Vehicle (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ¾Ğ±Ğ¸Ğ»Ğ¸)                        â”‚
â”‚  â€¢ Booking (Ğ·Ğ°ĞºĞ°Ğ·Ñ‹)                            â”‚
â”‚  â€¢ Admin (Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ñ‹)                      â”‚
â”‚  â€¢ Route, Location, Tariff, etc.              â”‚
â”‚                                                 â”‚
â”‚  Migrations: Prisma                            â”‚
â”‚  Backups: Daily at 02:00                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. Ğ’Ğ½ĞµÑˆĞ½Ğ¸Ğµ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          External Integrations                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  Telegram Bot API                               â”‚
â”‚  â”œâ”€â”€ Client Bot (Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹)                     â”‚
â”‚  â””â”€â”€ Driver Bot (Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒÑĞºĞ¸Ğ¹)                 â”‚
â”‚                                                 â”‚
â”‚  Webhook: https://srs.faruk.io/api/telegram/   â”‚
â”‚  Updates: message, callback_query              â”‚
â”‚                                                 â”‚
â”‚  Optional:                                      â”‚
â”‚  â””â”€â”€ Wialon API (tracking)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞŸĞ¾Ñ‚Ğ¾ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… (Data Flow)

### 1. ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ¾Ğ·Ğ´Ğ°ĞµÑ‚ Ğ·Ğ°ĞºĞ°Ğ· Ñ‡ĞµÑ€ĞµĞ· Telegram

```
[Telegram User] â†’ [Telegram Bot API]
                        â†“
                   (Webhook)
                        â†“
            [Nginx] â†’ [Backend API]
                        â†“
                  [PostgreSQL]
                        â†“
                  [Socket.IO]
                        â†“
            [Admin Dashboard] (real-time update)
```

### 2. ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ·Ğ°ĞºĞ°Ğ·Ğ°Ğ¼Ğ¸

```
[Admin Browser] â†’ [Frontend SPA]
                        â†“
                   (HTTPS/443)
                        â†“
            [Nginx] â†’ [Backend API]
                        â†“
                  [PostgreSQL]
                        â†“
                [Telegram Bot API]
                        â†“
            [Driver Telegram] (ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ)
```

### 3. WebSocket real-time Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ

```
[Admin Dashboard] â†â†’ [Socket.IO] â†â†’ [Backend]
                                        â†“
                                  [Database Events]
```

---

## Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ°Ñ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€Ğµ

```
/home/stc/
â”‚
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ stc-transfer/
â”‚       â”œâ”€â”€ backend/
â”‚       â”‚   â”œâ”€â”€ .env                    (ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)
â”‚       â”‚   â”œâ”€â”€ dist/                   (ÑĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´)
â”‚       â”‚   â”œâ”€â”€ node_modules/           (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸)
â”‚       â”‚   â”œâ”€â”€ prisma/                 (ÑÑ…ĞµĞ¼Ğ° Ğ‘Ğ”)
â”‚       â”‚   â””â”€â”€ src/                    (Ğ¸ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´)
â”‚       â”‚
â”‚       â”œâ”€â”€ frontend/
â”‚       â”‚   â”œâ”€â”€ .env.production         (ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)
â”‚       â”‚   â”œâ”€â”€ dist/                   (ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ frontend)
â”‚       â”‚   â””â”€â”€ node_modules/
â”‚       â”‚
â”‚       â”œâ”€â”€ logs/
â”‚       â”‚   â”œâ”€â”€ backend-out.log
â”‚       â”‚   â””â”€â”€ backend-error.log
â”‚       â”‚
â”‚       â”œâ”€â”€ deploy-scripts/             (ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ)
â”‚       â””â”€â”€ ecosystem.config.js         (PM2 ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ)
â”‚
â””â”€â”€ backups/
    â””â”€â”€ postgres/
        â”œâ”€â”€ backup_20251016_020000.sql.gz
        â”œâ”€â”€ backup_20251015_020000.sql.gz
        â””â”€â”€ ...
```

---

## ĞŸĞ¾Ñ€Ñ‚Ñ‹ Ğ¸ ÑĞµÑ‚ĞµĞ²Ğ°Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ

### ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ñ‹Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ (Firewall)

```
Port 22   â†’ SSH (Ğ·Ğ°Ñ‰Ğ¸Ñ‰ĞµĞ½ ĞºĞ»ÑÑ‡Ğ°Ğ¼Ğ¸)
Port 80   â†’ HTTP (redirect to HTTPS)
Port 443  â†’ HTTPS (Nginx)
```

### Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½Ğ¸Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ñ‹ (localhost only)

```
Port 3001 â†’ Backend API
Port 5432 â†’ PostgreSQL
```

### Ğ¡ĞµÑ‚ĞµĞ²Ğ¾Ğ¹ Ğ¿Ğ¾Ñ‚Ğ¾Ğº

```
Internet (443) â†’ Nginx â†’ Backend (3001) â†’ PostgreSQL (5432)
                  â†“
            Frontend (static)
```

---

## ĞŸÑ€Ğ¾Ñ†ĞµÑÑÑ‹ Ğ¸ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

### Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ systemd                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ nginx.service         (Nginx)             â”‚
â”‚ â€¢ postgresql.service    (PostgreSQL)        â”‚
â”‚ â€¢ certbot.timer         (SSL auto-renew)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PM2 Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑÑ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PM2                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ stc-backend (instance 1)                  â”‚
â”‚ â€¢ stc-backend (instance 2)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ (Security Layers)

### 1. Ğ¡ĞµÑ‚ĞµĞ²Ğ°Ñ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        UFW Firewall                     â”‚
â”‚  Only ports: 22, 80, 443 open          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. SSL/TLS

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Let's Encrypt SSL Certificate       â”‚
â”‚  â€¢ TLS 1.2/1.3                          â”‚
â”‚  â€¢ Auto-renewal every 90 days           â”‚
â”‚  â€¢ Strong cipher suites                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ĞŸÑ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Application Security               â”‚
â”‚  â€¢ JWT authentication                   â”‚
â”‚  â€¢ Rate limiting                        â”‚
â”‚  â€¢ CORS policy                          â”‚
â”‚  â€¢ Helmet.js security headers          â”‚
â”‚  â€¢ Input validation (Zod)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Database Security                 â”‚
â”‚  â€¢ Localhost only access               â”‚
â”‚  â€¢ Strong password                      â”‚
â”‚  â€¢ Separate user (not postgres)        â”‚
â”‚  â€¢ Daily backups                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. Telegram Webhook

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Telegram Webhook Security           â”‚
â”‚  â€¢ IP whitelist (Telegram servers)     â”‚
â”‚  â€¢ HTTPS only                           â”‚
â”‚  â€¢ Token in request                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Ğ£Ñ€Ğ¾Ğ²Ğ½Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

```
Application Layer
    â”œâ”€â”€ PM2 logs           â†’ ~/apps/stc-transfer/logs/
    â”œâ”€â”€ Console output     â†’ pm2 logs stc-backend
    â””â”€â”€ Error tracking     â†’ backend-error.log

Proxy Layer
    â”œâ”€â”€ Access logs        â†’ /var/log/nginx/stc-access.log
    â””â”€â”€ Error logs         â†’ /var/log/nginx/stc-error.log

Database Layer
    â””â”€â”€ PostgreSQL logs    â†’ /var/log/postgresql/

System Layer
    â””â”€â”€ System journal     â†’ journalctl
```

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸

```
PM2 Monitoring
    â”œâ”€â”€ CPU usage
    â”œâ”€â”€ Memory usage
    â”œâ”€â”€ Restart count
    â””â”€â”€ Uptime

System Monitoring
    â”œâ”€â”€ Disk space (df -h)
    â”œâ”€â”€ Memory (free -h)
    â”œâ”€â”€ CPU load (uptime)
    â””â”€â”€ Network (netstat)
```

---

## Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ğ¾Ğµ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Backup Strategy)

```
Daily Backups (02:00)
    â”œâ”€â”€ Database dump (compressed)
    â”œâ”€â”€ Retention: 7 days
    â””â”€â”€ Location: ~/backups/postgres/

Manual Backups
    â”œâ”€â”€ Before updates
    â”œâ”€â”€ Before migrations
    â””â”€â”€ On demand

Backup Contents
    â”œâ”€â”€ Database schema
    â”œâ”€â”€ All tables and data
    â””â”€â”€ Compressed with gzip
```

---

## ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ

```
1. Ğ‘ÑĞºĞ°Ğ¿ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
2. Git pull / Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸
3. Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹ (npm install)
4. ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ğ‘Ğ” (prisma migrate deploy)
5. Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° (npm run build)
6. PM2 reload (zero-downtime)
7. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° health-check
```

### Ğ“Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```
                Load Balancer (Nginx)
                        â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“               â†“               â†“
    Server 1        Server 2        Server 3
    (Backend)       (Backend)       (Backend)
        â†“               â†“               â†“
            Database (Master-Slave)
```

---

## ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

### ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

- PM2 cluster mode (2+ Ğ¸Ğ½ÑÑ‚Ğ°Ğ½ÑÑ‹)
- Nginx gzip compression
- PostgreSQL Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹
- Static Ñ„Ğ°Ğ¹Ğ»Ñ‹ ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (1 Ğ³Ğ¾Ğ´)
- Connection pooling (PostgreSQL)
- Keep-alive ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ

### Ğ£Ğ·ĞºĞ¸Ğµ Ğ¼ĞµÑÑ‚Ğ° (Bottlenecks)

1. Database queries (Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ: Ğ¸Ğ½Ğ´ĞµĞºÑÑ‹, Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²)
2. Memory usage (Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ: ÑƒĞ²ĞµĞ»Ğ¸Ñ‡ĞµĞ½Ğ¸Ğµ RAM, Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ´Ğ°)
3. Network I/O (Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ: CDN, compression)

---

## Disaster Recovery

### ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸

1. **Backend ÑĞ±Ğ¾Ğ¹**

   ```
   PM2 Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚
   Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ»Ğ¾: pm2 restart stc-backend
   ```

2. **Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ°**

   ```
   1. systemctl restart postgresql
   2. Ğ•ÑĞ»Ğ¸ Ğ½Ğµ Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ»Ğ¾: Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ±ÑĞºĞ°Ğ¿Ğ°
   ```

3. **Nginx ÑĞ±Ğ¾Ğ¹**

   ```
   1. nginx -t (Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ°)
   2. systemctl restart nginx
   ```

4. **ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ ÑĞ±Ğ¾Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€Ğ°**
   ```
   1. ĞĞ¾Ğ²Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€
   2. Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ±ÑĞºĞ°Ğ¿Ğ°
   3. ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ
   ```

---

## ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹ Ğ¸ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

- **ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾**: [DEPLOYMENT_GUIDE.md](DEPLOYMENT_GUIDE.md)
- **Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğ¹ ÑÑ‚Ğ°Ñ€Ñ‚**: [START_HERE.md](START_HERE.md)
- **Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ**: [SYSTEM_REQUIREMENTS.md](SYSTEM_REQUIREMENTS.md)
- **ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹**: [COMMANDS_CHEATSHEET.md](COMMANDS_CHEATSHEET.md)

---

_Ğ­Ñ‚Ğ° Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ½Ğ°Ğ´ĞµĞ¶Ğ½Ğ¾ÑÑ‚ÑŒ, Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ STC Transfer._
