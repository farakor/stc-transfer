<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ –≤ –ë–î</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .test-section {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .test-section h3 {
      margin-top: 0;
      color: #333;
    }

    .success {
      background-color: #d4edda;
      border-color: #c3e6cb;
      color: #155724;
    }

    .error {
      background-color: #f8d7da;
      border-color: #f5c6cb;
      color: #721c24;
    }

    .info {
      background-color: #d1ecf1;
      border-color: #bee5eb;
      color: #0c5460;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    button:hover {
      background-color: #0056b3;
    }

    button:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }

    input,
    select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: inline-block;
      width: 150px;
      font-weight: bold;
    }

    pre {
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      max-height: 300px;
    }

    .status {
      padding: 10px;
      border-radius: 4px;
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üß™ –¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–æ–≤ –≤ –ë–î</h1>
    <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–¥–µ–ª–µ "–¢–∞—Ä–∏—Ñ—ã"</p>

    <div id="status" class="status info">
      <strong>–°—Ç–∞—Ç—É—Å:</strong> –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
    </div>
  </div>

  <!-- –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ -->
  <div class="container">
    <div class="test-section">
      <h3>üèôÔ∏è –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏</h3>
      <div class="form-group">
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
        <input type="text" id="locationName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢–µ—Å—Ç –ì–æ—Ä–æ–¥" value="–¢–µ—Å—Ç –ì–æ—Ä–æ–¥">
      </div>
      <div class="form-group">
        <label>–¢–∏–ø:</label>
        <select id="locationType">
          <option value="city">–ì–æ—Ä–æ–¥</option>
          <option value="airport">–ê—ç—Ä–æ–ø–æ—Ä—Ç</option>
          <option value="station">–í–æ–∫–∑–∞–ª</option>
          <option value="attraction">–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
        </select>
      </div>
      <button onclick="testCreateLocation()">–°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é</button>
      <div id="locationResult"></div>
    </div>
  </div>

  <!-- –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞ -->
  <div class="container">
    <div class="test-section">
      <h3>üõ£Ô∏è –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞</h3>
      <div class="form-group">
        <label>–û—Ç–∫—É–¥–∞ (ID):</label>
        <input type="number" id="fromLocationId" placeholder="1" value="1">
      </div>
      <div class="form-group">
        <label>–ö—É–¥–∞ (ID):</label>
        <input type="number" id="toLocationId" placeholder="2" value="2">
      </div>
      <div class="form-group">
        <label>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º):</label>
        <input type="number" id="distanceKm" placeholder="50" value="50">
      </div>
      <div class="form-group">
        <label>–í—Ä–µ–º—è (–º–∏–Ω):</label>
        <input type="number" id="durationMin" placeholder="60" value="60">
      </div>
      <button onclick="testCreateRoute()">–°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç</button>
      <div id="routeResult"></div>
    </div>
  </div>

  <!-- –¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞ -->
  <div class="container">
    <div class="test-section">
      <h3>üí∞ –¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞</h3>
      <div class="form-group">
        <label>–ú–∞—Ä—à—Ä—É—Ç (ID):</label>
        <input type="number" id="tariffRouteId" placeholder="1" value="1">
      </div>
      <div class="form-group">
        <label>–ú–∞—Ä–∫–∞:</label>
        <input type="text" id="vehicleBrand" placeholder="Kia" value="Kia">
      </div>
      <div class="form-group">
        <label>–ú–æ–¥–µ–ª—å:</label>
        <input type="text" id="vehicleModel" placeholder="Carnival" value="Carnival">
      </div>
      <div class="form-group">
        <label>–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞:</label>
        <input type="number" id="basePrice" placeholder="100000" value="100000">
      </div>
      <div class="form-group">
        <label>–¶–µ–Ω–∞ –∑–∞ –∫–º:</label>
        <input type="number" id="pricePerKm" placeholder="3000" value="3000">
      </div>
      <button onclick="testCreateTariff()">–°–æ–∑–¥–∞—Ç—å —Ç–∞—Ä–∏—Ñ</button>
      <div id="tariffResult"></div>
    </div>
  </div>

  <!-- –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã -->
  <div class="container">
    <div class="test-section">
      <h3>üìä –¢–µ—Å—Ç 4: –ü–æ–ª—É—á–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã —Ç–∞—Ä–∏—Ñ–æ–≤</h3>
      <button onclick="testGetMatrix()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ç—Ä–∏—Ü—É</button>
      <button onclick="testGetLocations()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ–∫–∞—Ü–∏–∏</button>
      <button onclick="testGetRoutes()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç—ã</button>
      <button onclick="testGetTariffs()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã</button>
      <div id="matrixResult"></div>
    </div>
  </div>

  <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
  <div class="container">
    <div class="test-section">
      <h3>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤</h3>
      <div id="testResults">
        <p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –∑–¥–µ—Å—å...</p>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'http://localhost:3001/api/admin/tariffs';
    let testResults = [];

    function updateStatus(message, type = 'info') {
      const status = document.getElementById('status');
      status.className = `status ${type}`;
      status.innerHTML = `<strong>–°—Ç–∞—Ç—É—Å:</strong> ${message}`;
    }

    function addTestResult(test, success, message, data = null) {
      testResults.push({
        test,
        success,
        message,
        data,
        timestamp: new Date().toLocaleTimeString()
      });
      updateTestResults();
    }

    function updateTestResults() {
      const resultsDiv = document.getElementById('testResults');
      resultsDiv.innerHTML = testResults.map(result => `
                <div class="test-section ${result.success ? 'success' : 'error'}">
                    <strong>${result.timestamp} - ${result.test}:</strong> ${result.message}
                    ${result.data ? `<pre>${JSON.stringify(result.data, null, 2)}</pre>` : ''}
                </div>
            `).join('');
    }

    async function testCreateLocation() {
      const name = document.getElementById('locationName').value;
      const type = document.getElementById('locationType').value;

      if (!name) {
        addTestResult('–°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏', false, '–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ');
        return;
      }

      try {
        updateStatus('–°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏...', 'info');

        const response = await fetch(`${API_BASE}/locations`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, type })
        });

        const result = await response.json();

        if (result.success) {
          addTestResult('–°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏', true, `–õ–æ–∫–∞—Ü–∏—è "${name}" —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ`, result.data);
          document.getElementById('locationResult').innerHTML = `
                        <div class="success">‚úÖ –õ–æ–∫–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞! ID: ${result.data.id}</div>
                    `;
          updateStatus('–õ–æ–∫–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
        } else {
          throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }
      } catch (error) {
        addTestResult('–°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏', false, error.message);
        document.getElementById('locationResult').innerHTML = `
                    <div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>
                `;
        updateStatus('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏', 'error');
      }
    }

    async function testCreateRoute() {
      const fromLocationId = parseInt(document.getElementById('fromLocationId').value);
      const toLocationId = parseInt(document.getElementById('toLocationId').value);
      const distanceKm = parseFloat(document.getElementById('distanceKm').value);
      const estimatedDurationMinutes = parseInt(document.getElementById('durationMin').value);

      if (!fromLocationId || !toLocationId) {
        addTestResult('–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞', false, '–ù–µ —É–∫–∞–∑–∞–Ω—ã –ª–æ–∫–∞—Ü–∏–∏');
        return;
      }

      try {
        updateStatus('–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞...', 'info');

        const response = await fetch(`${API_BASE}/routes`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            from_location_id: fromLocationId,
            to_location_id: toLocationId,
            distance_km: distanceKm,
            estimated_duration_minutes: estimatedDurationMinutes
          })
        });

        const result = await response.json();

        if (result.success) {
          addTestResult('–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞', true, `–ú–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ`, result.data);
          document.getElementById('routeResult').innerHTML = `
                        <div class="success">‚úÖ –ú–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω! ID: ${result.data.id}</div>
                    `;
          updateStatus('–ú–∞—Ä—à—Ä—É—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
        } else {
          throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }
      } catch (error) {
        addTestResult('–°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞', false, error.message);
        document.getElementById('routeResult').innerHTML = `
                    <div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>
                `;
        updateStatus('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞', 'error');
      }
    }

    async function testCreateTariff() {
      const routeId = parseInt(document.getElementById('tariffRouteId').value);
      const vehicleBrand = document.getElementById('vehicleBrand').value;
      const vehicleModel = document.getElementById('vehicleModel').value;
      const basePrice = parseFloat(document.getElementById('basePrice').value);
      const pricePerKm = parseFloat(document.getElementById('pricePerKm').value);

      if (!routeId || !vehicleBrand || !vehicleModel) {
        addTestResult('–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞', false, '–ù–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã');
        return;
      }

      try {
        updateStatus('–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞...', 'info');

        const response = await fetch(`${API_BASE}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            route_id: routeId,
            vehicle_brand: vehicleBrand,
            vehicle_model: vehicleModel,
            base_price: basePrice,
            price_per_km: pricePerKm
          })
        });

        const result = await response.json();

        if (result.success) {
          addTestResult('–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞', true, `–¢–∞—Ä–∏—Ñ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ`, result.data);
          document.getElementById('tariffResult').innerHTML = `
                        <div class="success">‚úÖ –¢–∞—Ä–∏—Ñ —Å–æ–∑–¥–∞–Ω! ID: ${result.data.id}</div>
                    `;
          updateStatus('–¢–∞—Ä–∏—Ñ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
        } else {
          throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }
      } catch (error) {
        addTestResult('–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞', false, error.message);
        document.getElementById('tariffResult').innerHTML = `
                    <div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>
                `;
        updateStatus('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞', 'error');
      }
    }

    async function testGetMatrix() {
      try {
        updateStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç—Ä–∏—Ü—ã...', 'info');

        const response = await fetch(`${API_BASE}/matrix`);
        const result = await response.json();

        if (result.success) {
          const { routes, vehicleModels, tariffs } = result.data;
          addTestResult('–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç—Ä–∏—Ü—ã', true,
            `–ú–∞—Ç—Ä–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞: ${routes.length} –º–∞—Ä—à—Ä—É—Ç–æ–≤, ${vehicleModels.length} –º–æ–¥–µ–ª–µ–π, ${Object.keys(tariffs).length} –≥—Ä—É–ø–ø —Ç–∞—Ä–∏—Ñ–æ–≤`,
            { routesCount: routes.length, vehicleModelsCount: vehicleModels.length, tariffsCount: Object.keys(tariffs).length }
          );
          document.getElementById('matrixResult').innerHTML = `
                        <div class="success">‚úÖ –ú–∞—Ç—Ä–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞: ${routes.length} –º–∞—Ä—à—Ä—É—Ç–æ–≤, ${vehicleModels.length} –º–æ–¥–µ–ª–µ–π</div>
                    `;
          updateStatus('–ú–∞—Ç—Ä–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
        } else {
          throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }
      } catch (error) {
        addTestResult('–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç—Ä–∏—Ü—ã', false, error.message);
        document.getElementById('matrixResult').innerHTML = `
                    <div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>
                `;
        updateStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ç—Ä–∏—Ü—ã', 'error');
      }
    }

    async function testGetLocations() {
      try {
        const response = await fetch(`${API_BASE}/locations`);
        const result = await response.json();

        if (result.success) {
          addTestResult('–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞—Ü–∏–π', true, `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${result.data.length} –ª–æ–∫–∞—Ü–∏–π`, result.data);
          updateStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${result.data.length} –ª–æ–∫–∞—Ü–∏–π`, 'success');
        } else {
          throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }
      } catch (error) {
        addTestResult('–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞—Ü–∏–π', false, error.message);
        updateStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞—Ü–∏–π', 'error');
      }
    }

    async function testGetRoutes() {
      try {
        const response = await fetch(`${API_BASE}/routes`);
        const result = await response.json();

        if (result.success) {
          addTestResult('–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤', true, `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${result.data.length} –º–∞—Ä—à—Ä—É—Ç–æ–≤`, result.data);
          updateStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${result.data.length} –º–∞—Ä—à—Ä—É—Ç–æ–≤`, 'success');
        } else {
          throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }
      } catch (error) {
        addTestResult('–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤', false, error.message);
        updateStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤', 'error');
      }
    }

    async function testGetTariffs() {
      try {
        const response = await fetch(`${API_BASE}`);
        const result = await response.json();

        if (result.success) {
          addTestResult('–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤', true, `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${result.data.length} —Ç–∞—Ä–∏—Ñ–æ–≤`, result.data);
          updateStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${result.data.length} —Ç–∞—Ä–∏—Ñ–æ–≤`, 'success');
        } else {
          throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }
      } catch (error) {
        addTestResult('–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤', false, error.message);
        updateStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–∞—Ä–∏—Ñ–æ–≤', 'error');
      }
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç—Ä–∏—Ü—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', () => {
      setTimeout(() => {
        testGetMatrix();
      }, 1000);
    });
  </script>
</body>

</html>