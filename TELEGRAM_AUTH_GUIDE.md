# üîê –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Telegram

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Telegram —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –ö–ª–∏–µ–Ω—Ç—ã —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Backend

#### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Prisma Schema)

–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ –º–æ–¥–µ–ª—å `User`:

```prisma
model User {
  auth_token        String?   @unique  // JWT —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  is_phone_verified Boolean   @default(false)  // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω –ª–∏ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
}
```

#### 2. Auth Service (`backend/src/services/authService.ts`)

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

- `generateAuthToken()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞ (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è 30 –¥–Ω–µ–π)
- `verifyTelegramWebAppData()` - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Telegram Web App
- `authenticateUser()` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `updateUserPhone()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `getUserByToken()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç–æ–∫–µ–Ω—É
- `logout()` - –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

#### 3. Auth Controller (`backend/src/controllers/authController.ts`)

–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:

- `POST /api/auth/telegram` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram (–ø—É–±–ª–∏—á–Ω—ã–π)
- `GET /api/auth/me` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π)
- `PUT /api/auth/phone` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π)
- `POST /api/auth/logout` - –≤—ã—Ö–æ–¥ (–∑–∞—â–∏—â–µ–Ω–Ω—ã–π)

#### 4. Middleware (`backend/src/middleware/clientAuth.ts`)

- `clientAuth` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `optionalClientAuth` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

#### 5. Telegram Bot (`backend/src/services/telegramBot.ts`)

–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π flow:

1. `/start` ‚Üí –í—ã–±–æ—Ä —è–∑—ã–∫–∞
2. –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞ ‚Üí –ó–∞–ø—Ä–æ—Å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–∫–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º")
3. –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ ‚Üí –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π "–ó–∞–∫–∞–∑–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä"

–ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:

- `handleContactShared()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
- `requestPhoneNumber()` - –∑–∞–ø—Ä–æ—Å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

#### 6. –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (`backend/src/locales/botMessages.ts`)

–î–æ–±–∞–≤–ª–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ —Ç—Ä–µ—Ö —è–∑—ã–∫–∞—Ö (ru, en, uz):

- `phoneRequest` - –∑–∞–ø—Ä–æ—Å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- `sharePhone` - —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º"
- `phoneVerified` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞

### Frontend

#### 1. Telegram Auth Service (`frontend/src/services/telegramAuth.ts`)

–ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Web App API:

–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

- `init()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
- `getWebApp()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ Web App
- `isTelegramWebApp()` - –ø—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–ø—É—â–µ–Ω–æ –ª–∏ –≤ Telegram
- `getUser()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
- `getInitData()` - –ø–æ–ª—É—á–µ–Ω–∏–µ initData –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `authenticate()` - –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- `getAuthToken()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
- `isAuthenticated()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `logout()` - –≤—ã—Ö–æ–¥
- `showBackButton()` / `hideBackButton()` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥"
- `showMainButton()` / `hideMainButton()` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π
- `hapticFeedback()` - —Ç–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
- `getColorScheme()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–º—ã (light/dark)

#### 2. Auth Hook (`frontend/src/hooks/useAuth.ts`)

React —Ö—É–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π:

```typescript
const {
  isAuthenticated, // –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  isLoading, // –ò–¥–µ—Ç –ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  user, // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  error, // –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  authenticate, // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  logout, // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞
} = useAuth();
```

#### 3. API Service (`frontend/src/services/api.ts`)

–û–±–Ω–æ–≤–ª–µ–Ω interceptor –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏:

```typescript
Authorization: Bearer<authToken>;
```

#### 4. App Component (`frontend/src/App.tsx`)

–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Ö—É–∫ `useAuth`:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ü–æ–∫–∞–∑ —ç–∫—Ä–∞–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ –≤—Ä–µ–º—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

## –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

### –î–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç –≤ Telegram**

   - –ù–∞–∂–∏–º–∞–µ—Ç `/start`

2. **–í—ã–±–æ—Ä —è–∑—ã–∫–∞**

   - –ë–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–±—Ä–∞—Ç—å —è–∑—ã–∫ (ru/en/uz)
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —è–∑—ã–∫

3. **–ó–∞–ø—Ä–æ—Å –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞**

   - –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º"
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É –∏ –¥–µ–ª–∏—Ç—Å—è –Ω–æ–º–µ—Ä–æ–º

4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞**

   - –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
   - –ù–æ–º–µ—Ä –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–π
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —É—Å–ø–µ—à–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

5. **–û—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

   - –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ó–∞–∫–∞–∑–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä"
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É
   - –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Web App

6. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏**
   - Frontend –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ Telegram Web App
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
   - –°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è JWT —Ç–æ–∫–µ–Ω
   - –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –±–æ—Ç
2. –ë–æ—Ç —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ó–∞–∫–∞–∑–∞—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä"
3. –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ Web App –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º—É —Ç–æ–∫–µ–Ω—É

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### JWT –¢–æ–∫–µ–Ω—ã

- –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è: 30 –¥–Ω–µ–π
- –•—Ä–∞–Ω–µ–Ω–∏–µ: localStorage –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, –ø–æ–ª–µ `auth_token` –≤ –ë–î
- –ê–ª–≥–æ—Ä–∏—Ç–º: HS256
- Secret: –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `JWT_SECRET`

### –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö Telegram

–î–∞–Ω–Ω—ã–µ –∏–∑ Telegram Web App –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ HMAC:

1. –ò–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è hash –∏–∑ initData
2. –°–æ–∑–¥–∞–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
3. –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è HMAC —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
4. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º hash

### –ó–∞—â–∏—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã middleware `clientAuth`:

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ Authorization
- –¢–æ–∫–µ–Ω –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ JWT
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ req.user

## API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü—É–±–ª–∏—á–Ω—ã–µ

#### POST /api/auth/telegram

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Web App

**Request:**

```json
{
  "initData": "query_id=...",
  "userData": {
    "id": 12345,
    "first_name": "John",
    "last_name": "Doe",
    "username": "johndoe",
    "language_code": "en"
  }
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "authToken": "eyJhbGc...",
    "user": {
      "id": 1,
      "telegramId": "12345",
      "firstName": "John",
      "lastName": "Doe",
      "username": "johndoe",
      "phone": "+998901234567",
      "languageCode": "en",
      "isPhoneVerified": true
    }
  }
}
```

### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ (—Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω)

#### GET /api/auth/me

–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

**Headers:**

```
Authorization: Bearer <authToken>
```

**Response:**

```json
{
  "success": true,
  "data": {
    "id": 1,
    "telegramId": "12345",
    "firstName": "John",
    "phone": "+998901234567",
    "languageCode": "en",
    "isPhoneVerified": true
  }
}
```

#### PUT /api/auth/phone

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

**Headers:**

```
Authorization: Bearer <authToken>
```

**Request:**

```json
{
  "phone": "+998901234567"
}
```

**Response:**

```json
{
  "success": true,
  "data": {
    "id": 1,
    "phone": "+998901234567",
    "isPhoneVerified": true
  }
}
```

#### POST /api/auth/logout

–í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

**Headers:**

```
Authorization: Bearer <authToken>
```

**Response:**

```json
{
  "success": true,
  "message": "Logged out successfully"
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### Backend - –ó–∞—â–∏—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞

```typescript
import { clientAuth } from '@/middleware/clientAuth'

// –ó–∞—â–∏—â–µ–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
router.post('/bookings', clientAuth, BookingController.createBooking)

// –í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ
static async createBooking(req: Request, res: Response) {
  const userId = (req as any).userId  // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ middleware
  const user = (req as any).user      // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

  // –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  const booking = await BookingService.create({
    userId,
    ...req.body
  })

  res.json({ success: true, data: booking })
}
```

### Frontend - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

```typescript
import { useAuth } from "@/hooks/useAuth";

function MyComponent() {
  const { isAuthenticated, user, logout } = useAuth();

  if (!isAuthenticated) {
    return <div>–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</div>;
  }

  return (
    <div>
      <p>–ü—Ä–∏–≤–µ—Ç, {user?.firstName}!</p>
      <p>–¢–µ–ª–µ—Ñ–æ–Ω: {user?.phone}</p>
      <button onClick={logout}>–í—ã–π—Ç–∏</button>
    </div>
  );
}
```

### Frontend - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Telegram Web App API

```typescript
import TelegramAuthService from "@/services/telegramAuth";

// –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
TelegramAuthService.showBackButton(() => {
  navigate(-1);
});

// –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
TelegramAuthService.showMainButton("–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", () => {
  handleSubmit();
});

// Haptic feedback
TelegramAuthService.hapticFeedback("success");

// –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–º—É
const colorScheme = TelegramAuthService.getColorScheme();
```

## –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Backend

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Telegram Web App –∏–ª–∏ —Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

### Frontend

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ –Ω–µ –≤ Telegram:

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å–∏–º—É–ª–∏—Ä—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —Ä–µ–∂–∏–º–µ –∑–∞–≥–ª—É—à–µ–∫

Mock –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:

```typescript
{
  id: 1,
  telegramId: '12345',
  firstName: 'Test',
  lastName: 'User',
  username: 'testuser',
  phone: '+998901234567',
  languageCode: 'ru',
  isPhoneVerified: true
}
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Backend (.env)

```env
# JWT Secret –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤
JWT_SECRET="your-super-secret-jwt-key-here"

# Telegram Bot Token (–¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö)
TELEGRAM_BOT_TOKEN="your-bot-token"
```

## –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞:

- `20251013000000_add_user_auth_fields`

–ò–∑–º–µ–Ω–µ–Ω–∏—è:

- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `auth_token` (TEXT, UNIQUE)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `is_phone_verified` (BOOLEAN, DEFAULT false)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ flow –≤ –±–æ—Ç–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç
npm run start:bot

# –í Telegram:
# 1. /start
# 2. –í—ã–±—Ä–∞—Ç—å —è–∑—ã–∫
# 3. –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º
# 4. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å backend
cd backend && npm run dev

# –ó–∞–ø—É—Å—Ç–∏—Ç—å frontend
cd frontend && npm run dev

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–¥–ª—è development —Ä–µ–∂–∏–º–∞)
# –û—Ç–∫—Ä—ã—Ç—å —á–µ—Ä–µ–∑ Telegram Web App (–¥–ª—è production —Ä–µ–∂–∏–º–∞)
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

```bash
# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
curl -X POST http://localhost:3001/api/auth/telegram \
  -H "Content-Type: application/json" \
  -d '{
    "userData": {
      "id": 12345,
      "first_name": "Test",
      "language_code": "ru"
    }
  }'

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl http://localhost:3001/api/auth/me \
  -H "Authorization: Bearer <token>"

# –í—ã—Ö–æ–¥
curl -X POST http://localhost:3001/api/auth/logout \
  -H "Authorization: Bearer <token>"
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### 1. –û—à–∏–±–∫–∞ "Invalid token"

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**

- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JWT_SECRET –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –û—á–∏—Å—Ç–∏—Ç—å localStorage –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

### 2. –ë–æ—Ç –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–æ–º–µ—Ä —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**

- –£–¥–∞–ª–∏—Ç—å –Ω–æ–º–µ—Ä –∏–∑ –ë–î –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 3. Frontend –Ω–µ –º–æ–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö Telegram Web App

**–†–µ—à–µ–Ω–∏–µ:**

- –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å mock –¥–∞–Ω–Ω—ã–µ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### 4. CORS –æ—à–∏–±–∫–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ CORS

**–†–µ—à–µ–Ω–∏–µ:**

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å ALLOWED_ORIGINS –≤ .env
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ ngrok URL –¥–æ–±–∞–≤–ª–µ–Ω

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**

   - SMS –∫–æ–¥ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - Email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ

2. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤**

   - Refresh tokens
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏

3. **–ê—É–¥–∏—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**

   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–æ–≤
   - –ò—Å—Ç–æ—Ä–∏—è —Å–µ—Å—Å–∏–π
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏

4. **–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**

   - Google
   - Facebook
   - Apple

5. **–ë–∏–æ–º–µ—Ç—Ä–∏—è**
   - Face ID
   - Touch ID
   - –û—Ç–ø–µ—á–∞—Ç–æ–∫ –ø–∞–ª—å—Ü–∞

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ö–ª–∏–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Telegram –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–í—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞–¥–µ–∂–Ω–æ –∑–∞—â–∏—â–µ–Ω—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º JWT —Ç–æ–∫–µ–Ω–æ–≤ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö Telegram Web App.
