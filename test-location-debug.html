<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    input,
    select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
    }

    button:hover {
      background-color: #0056b3;
    }

    button:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }

    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 4px;
    }

    .success {
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
    }

    .error {
      background-color: #f8d7da;
      border: 1px solid #f5c6cb;
      color: #721c24;
    }

    .info {
      background-color: #d1ecf1;
      border: 1px solid #bee5eb;
      color: #0c5460;
    }

    pre {
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üèôÔ∏è –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏</h1>
    <p>–≠—Ç–æ—Ç —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API</p>

    <form id="locationForm">
      <div class="form-group">
        <label for="name">–ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏:</label>
        <input type="text" id="name" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢–µ—Å—Ç –ì–æ—Ä–æ–¥" required>
      </div>

      <div class="form-group">
        <label for="type">–¢–∏–ø –ª–æ–∫–∞—Ü–∏–∏:</label>
        <select id="type" required>
          <option value="city">–ì–æ—Ä–æ–¥</option>
          <option value="airport">–ê—ç—Ä–æ–ø–æ—Ä—Ç</option>
          <option value="station">–í–æ–∫–∑–∞–ª</option>
          <option value="attraction">–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å</option>
        </select>
      </div>

      <button type="submit" id="submitBtn">–°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é</button>
    </form>

    <div id="result"></div>
  </div>

  <script>
    const API_BASE = 'http://localhost:3001/api/admin/tariffs';

    document.getElementById('locationForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const name = document.getElementById('name').value.trim();
      const type = document.getElementById('type').value;
      const submitBtn = document.getElementById('submitBtn');
      const resultDiv = document.getElementById('result');

      if (!name) {
        showResult('error', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏');
        return;
      }

      try {
        submitBtn.disabled = true;
        submitBtn.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ...';

        showResult('info', '–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä...');
        console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ:', { name, type });

        const response = await fetch(`${API_BASE}/locations`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ name, type })
        });

        console.log('üì° –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', response.status, response.statusText);

        if (!response.ok) {
          const errorText = await response.text();
          console.error('‚ùå –û—à–∏–±–∫–∞ HTTP:', errorText);
          throw new Error(`HTTP ${response.status}: ${errorText}`);
        }

        const result = await response.json();
        console.log('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:', result);

        if (result.success) {
          showResult('success', `‚úÖ –õ–æ–∫–∞—Ü–∏—è "${name}" —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ!`, result.data);
          document.getElementById('locationForm').reset();
        } else {
          throw new Error(result.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
        }

      } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞:', error);
        showResult('error', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = '–°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é';
      }
    });

    function showResult(type, message, data = null) {
      const resultDiv = document.getElementById('result');
      resultDiv.className = `result ${type}`;

      let html = `<strong>${message}</strong>`;

      if (data) {
        html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
      }

      resultDiv.innerHTML = html;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', async () => {
      try {
        const response = await fetch(`${API_BASE}/matrix`);
        if (response.ok) {
          showResult('success', '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
        } else {
          showResult('error', '‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        }
      } catch (error) {
        showResult('error', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
      }
    });
  </script>
</body>

</html>